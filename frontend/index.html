<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In-Memory Database System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .tabs { display: flex; background: #f5f5f5; border-bottom: 2px solid #ddd; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; background: #f5f5f5; border: none; font-size: 16px; transition: all 0.3s; }
        .tab:hover { background: #e0e0e0; }
        .tab.active { background: white; border-bottom: 3px solid #667eea; font-weight: bold; }
        .content { padding: 30px; display: none; }
        .content.active { display: block; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 16px; }
        .btn { padding: 12px 30px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; transition: all 0.3s; margin-right: 10px; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #667eea; color: white; }
        .alert { padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        .alert-success { background: #d4edda; color: #155724; }
        .alert-error { background: #f8d7da; color: #721c24; }
        .column-item { display: flex; gap: 10px; margin-bottom: 10px; }
        #logConsole { background: #1e1e1e; color: #00ff00; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 14px; max-height: 300px; overflow-y: auto; margin: 20px; }
        .log-entry { margin: 5px 0; }
        .log-time { color: #888; }
        .log-action { color: #00ff00; font-weight: bold; }
        .log-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .log-toggle { background: #00ff00; color: #1e1e1e; border: none; padding: 5px 15px; border-radius: 3px; cursor: pointer; font-weight: bold; }
        .log-toggle:hover { background: #00cc00; }
        #logEntries.collapsed { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üóÑÔ∏è In-Memory Database System</h1>
            <p>Design Patterns Project</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('create')">‚ûï Create Table</button>
            <button class="tab" onclick="showTab('insert')">üìù Insert Row</button>
            <button class="tab" onclick="showTab('update')">‚úèÔ∏è Update Row</button>
            <button class="tab" onclick="showTab('query')">üîç Query</button>
            <button class="tab" onclick="showTab('view')">üìä View Tables</button>
            <button class="tab" onclick="showTab('clone')">üìã Clone Table</button>
            <button class="tab" onclick="showTab('delete')">üóëÔ∏è Delete Table</button>
        </div>

        <div id="message"></div>

        <!-- Observer Pattern - Log Console -->
        <div id="logConsole">
            <div class="log-header">
                <strong>üìã Change Log (Observer Pattern)</strong>
                <button class="log-toggle" onclick="toggleLog()">Hide</button>
            </div>
            <div id="logEntries"></div>
        </div>

        <div id="create" class="content active">
            <h2>Create New Table</h2>
            <div class="form-group">
                <label>Table Name:</label>
                <input type="text" id="tableName" placeholder="Enter table name">
            </div>
            <div class="form-group">
                <label>Column Name:</label>
                <input type="text" id="colName" placeholder="Column name">
            </div>
            <div class="form-group">
                <label>Column Type:</label>
                <select id="colType">
                    <option value="String">String</option>
                    <option value="Integer">Integer</option>
                    <option value="Boolean">Boolean</option>
                </select>
            </div>
            <button class="btn btn-success" onclick="addColumn()">Add Column</button>
            <div id="columnsList"></div>
            <button class="btn btn-primary" onclick="createTable()">Create Table</button>
        </div>

        <div id="insert" class="content">
            <h2>Insert Row</h2>
            <div class="form-group">
                <label>Select Table:</label>
                <select id="insertTable" onchange="showInsertFields()">
                    <option value="">-- Select Table --</option>
                </select>
            </div>
            <div id="insertFields"></div>
            <button class="btn btn-primary" onclick="insertRow()">Insert Row</button>
        </div>

        <div id="update" class="content">
            <h2>Update Row</h2>
            <div class="form-group">
                <label>Select Table:</label>
                <select id="updateTable" onchange="showUpdateRows()">
                    <option value="">-- Select Table --</option>
                </select>
            </div>
            <div class="form-group">
                <label>Select Row:</label>
                <select id="updateRowIndex" onchange="showUpdateFields()">
                    <option value="">-- Select Row --</option>
                </select>
            </div>
            <div id="updateFields"></div>
            <button class="btn btn-primary" onclick="updateRow()">Update Row</button>
        </div>

        <div id="query" class="content">
            <h2>Query Data</h2>
            <div class="form-group">
                <label>Select Table:</label>
                <select id="queryTable" onchange="updateQueryColumns()">
                    <option value="">-- Select Table --</option>
                </select>
            </div>
            <h3>Condition 1:</h3>
            <div class="form-group">
                <label>Column:</label>
                <select id="queryColumn">
                    <option value="">-- All Rows --</option>
                </select>
            </div>
            <div class="form-group">
                <label>Operator:</label>
                <select id="queryOp">
                    <option value="Equal">Equal (=)</option>
                    <option value="NotEqual">Not Equal (!=)</option>
                    <option value="Greater">Greater Than (>)</option>
                    <option value="Less">Less Than (<)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Value:</label>
                <input type="text" id="queryValue" placeholder="Enter value">
            </div>
            <div class="form-group">
                <label>Combine with:</label>
                <select id="queryCombine">
                    <option value="none">None (Single Condition)</option>
                    <option value="AND">AND</option>
                    <option value="OR">OR</option>
                </select>
            </div>
            <div id="condition2" style="display:none;">
                <h3>Condition 2:</h3>
                <div class="form-group">
                    <label>Column:</label>
                    <select id="queryColumn2"></select>
                </div>
                <div class="form-group">
                    <label>Operator:</label>
                    <select id="queryOp2">
                        <option value="Equal">Equal (=)</option>
                        <option value="NotEqual">Not Equal (!=)</option>
                        <option value="Greater">Greater Than (>)</option>
                        <option value="Less">Less Than (<)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Value:</label>
                    <input type="text" id="queryValue2" placeholder="Enter value">
                </div>
            </div>
            <button class="btn btn-primary" onclick="queryData()">Query</button>
            <div id="queryResults"></div>
        </div>

        <div id="view" class="content">
            <h2>All Tables</h2>
            <div id="allTables"></div>
        </div>

        <div id="clone" class="content">
            <h2>Clone Table</h2>
            <div class="form-group">
                <label>Select Table:</label>
                <select id="cloneTable">
                    <option value="">-- Select Table --</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="cloneTable()">Clone Table</button>
        </div>

        <div id="delete" class="content">
            <h2>Delete Table</h2>
            <div class="form-group">
                <label>Select Table to Delete:</label>
                <select id="deleteTable">
                    <option value="">-- Select Table --</option>
                </select>
            </div>
            <button class="btn btn-danger" onclick="deleteTable()">Delete Table</button>
        </div>
    </div>

    <script>
        let tables = [];
        let tempColumns = [];
        let logVisible = true;

        // Load data from localStorage on page load
        window.addEventListener('DOMContentLoaded', function() {
            const savedTables = localStorage.getItem('databaseTables');
            if (savedTables) {
                tables = JSON.parse(savedTables);
                updateSelects();
                showMessage('Previous data loaded successfully!', 'success');
            }
        });

        function toggleLog() {
            logVisible = !logVisible;
            const entries = document.getElementById('logEntries');
            const btn = document.querySelector('.log-toggle');
            if (logVisible) {
                entries.classList.remove('collapsed');
                btn.textContent = 'Hide';
            } else {
                entries.classList.add('collapsed');
                btn.textContent = 'Show';
            }
        }

        // Save data to localStorage
        function saveToLocalStorage() {
            localStorage.setItem('databaseTables', JSON.stringify(tables));
        }

        // Observer Pattern - Log changes
        function logChange(action, details) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `<div class="log-entry"><span class="log-time">[${timestamp}]</span> <span class="log-action">${action}:</span> ${details}</div>`;
            const logEntries = document.getElementById('logEntries');
            logEntries.innerHTML = logEntry + logEntries.innerHTML;
            console.log(`[${timestamp}] ${action}: ${details}`);
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            updateSelects();
        }

        function showMessage(msg, type) {
            const msgDiv = document.getElementById('message');
            msgDiv.innerHTML = `<div class="alert alert-${type}" style="margin: 20px;">${msg}</div>`;
            setTimeout(() => msgDiv.innerHTML = '', 3000);
        }

        function addColumn() {
            const name = document.getElementById('colName').value;
            const type = document.getElementById('colType').value;
            if (!name) return showMessage('Enter column name', 'error');
            
            tempColumns.push({name, type});
            document.getElementById('colName').value = '';
            updateColumnsList();
        }

        function updateColumnsList() {
            const list = document.getElementById('columnsList');
            list.innerHTML = '<h3>Columns:</h3>' + tempColumns.map((c, i) => 
                `<div class="column-item">${c.name} (${c.type}) <button class="btn btn-danger" onclick="removeColumn(${i})">Remove</button></div>`
            ).join('');
        }

        function removeColumn(index) {
            tempColumns.splice(index, 1);
            updateColumnsList();
        }

        function createTable() {
            const name = document.getElementById('tableName').value;
            if (!name || tempColumns.length === 0) return showMessage('Enter table name and add columns', 'error');
            
            tables.push({name, columns: [...tempColumns], rows: []});
            saveToLocalStorage();
            logChange('CREATE TABLE', `Table '${name}' created with ${tempColumns.length} columns`);
            showMessage(`Table '${name}' created!`, 'success');
            document.getElementById('tableName').value = '';
            tempColumns = [];
            updateColumnsList();
            updateSelects();
        }

        function updateSelects() {
            const selects = ['insertTable', 'updateTable', 'queryTable', 'cloneTable', 'deleteTable'];
            selects.forEach(id => {
                const select = document.getElementById(id);
                select.innerHTML = '<option value="">-- Select Table --</option>' + 
                    tables.map((t, i) => `<option value="${i}">${t.name}</option>`).join('');
            });
            showAllTables();
        }

        function showInsertFields() {
            const tableIndex = document.getElementById('insertTable').value;
            if (!tableIndex) return;
            const table = tables[tableIndex];
            document.getElementById('insertFields').innerHTML = table.columns.map(c => 
                `<div class="form-group"><label>${c.name} (${c.type}):</label><input type="text" id="field_${c.name}"></div>`
            ).join('');
        }

        function insertRow() {
            const tableIndex = document.getElementById('insertTable').value;
            if (!tableIndex) return showMessage('Select a table', 'error');
            
            const table = tables[tableIndex];
            const row = {};
            
            // Validation: Check all fields have values
            for (let c of table.columns) {
                const value = document.getElementById(`field_${c.name}`).value;
                if (!value || value.trim() === '') {
                    return showMessage(`Missing value for column: ${c.name}`, 'error');
                }
                
                // Validation: Check data types
                if (c.type === 'Integer') {
                    if (isNaN(value) || !Number.isInteger(Number(value))) {
                        return showMessage(`Column ${c.name} must be an integer`, 'error');
                    }
                    row[c.name] = parseInt(value);
                } else if (c.type === 'Boolean') {
                    if (value !== 'true' && value !== 'false') {
                        return showMessage(`Column ${c.name} must be true or false`, 'error');
                    }
                    row[c.name] = value === 'true';
                } else {
                    row[c.name] = value;
                }
            }
            
            table.rows.push(row);
            saveToLocalStorage();
            logChange('INSERT ROW', `Row inserted into table '${table.name}'`);
            showMessage('Row inserted successfully!', 'success');
            showInsertFields();
        }

        function showUpdateRows() {
            const tableIndex = document.getElementById('updateTable').value;
            if (!tableIndex) return;
            const table = tables[tableIndex];
            const select = document.getElementById('updateRowIndex');
            select.innerHTML = '<option value="">-- Select Row --</option>' + 
                table.rows.map((r, i) => `<option value="${i}">Row ${i}: ${JSON.stringify(r)}</option>`).join('');
        }

        function showUpdateFields() {
            const tableIndex = document.getElementById('updateTable').value;
            const rowIndex = document.getElementById('updateRowIndex').value;
            if (!tableIndex || !rowIndex) return;
            
            const table = tables[tableIndex];
            const row = table.rows[rowIndex];
            document.getElementById('updateFields').innerHTML = table.columns.map(c => 
                `<div class="form-group"><label>${c.name} (${c.type}):</label><input type="text" id="update_${c.name}" value="${row[c.name]}"></div>`
            ).join('');
        }

        function updateRow() {
            const tableIndex = document.getElementById('updateTable').value;
            const rowIndex = document.getElementById('updateRowIndex').value;
            if (!tableIndex || !rowIndex) return showMessage('Select table and row', 'error');
            
            const table = tables[tableIndex];
            const row = {};
            
            for (let c of table.columns) {
                const value = document.getElementById(`update_${c.name}`).value;
                if (!value || value.trim() === '') {
                    return showMessage(`Missing value for column: ${c.name}`, 'error');
                }
                
                if (c.type === 'Integer') {
                    if (isNaN(value) || !Number.isInteger(Number(value))) {
                        return showMessage(`Column ${c.name} must be an integer`, 'error');
                    }
                    row[c.name] = parseInt(value);
                } else if (c.type === 'Boolean') {
                    if (value !== 'true' && value !== 'false') {
                        return showMessage(`Column ${c.name} must be true or false`, 'error');
                    }
                    row[c.name] = value === 'true';
                } else {
                    row[c.name] = value;
                }
            }
            
            table.rows[rowIndex] = row;
            saveToLocalStorage();
            logChange('UPDATE ROW', `Row ${rowIndex} updated in table '${table.name}'`);
            showMessage('Row updated successfully!', 'success');
        }

        function updateQueryColumns() {
            const tableIndex = document.getElementById('queryTable').value;
            if (!tableIndex) return;
            const table = tables[tableIndex];
            const options = table.columns.map(c => `<option value="${c.name}">${c.name}</option>`).join('');
            document.getElementById('queryColumn').innerHTML = '<option value="">-- All Rows --</option>' + options;
            document.getElementById('queryColumn2').innerHTML = options;
        }

        document.getElementById('queryCombine').addEventListener('change', function() {
            document.getElementById('condition2').style.display = this.value !== 'none' ? 'block' : 'none';
        });

        function evaluateCondition(row, column, op, value) {
            const rowVal = row[column];
            switch(op) {
                case 'Equal': return rowVal == value;
                case 'NotEqual': return rowVal != value;
                case 'Greater': return Number(rowVal) > Number(value);
                case 'Less': return Number(rowVal) < Number(value);
            }
        }

        function queryData() {
            const tableIndex = document.getElementById('queryTable').value;
            if (!tableIndex) return showMessage('Select a table', 'error');
            
            const table = tables[tableIndex];
            const column = document.getElementById('queryColumn').value;
            const op = document.getElementById('queryOp').value;
            const value = document.getElementById('queryValue').value;
            const combine = document.getElementById('queryCombine').value;
            
            let results = table.rows;
            let queryDesc = '';
            
            if (column && value) {
                if (combine === 'none') {
                    results = results.filter(row => evaluateCondition(row, column, op, value));
                    queryDesc = `${column} ${op} ${value}`;
                } else {
                    const column2 = document.getElementById('queryColumn2').value;
                    const op2 = document.getElementById('queryOp2').value;
                    const value2 = document.getElementById('queryValue2').value;
                    
                    if (!column2 || !value2) return showMessage('Fill second condition', 'error');
                    
                    results = results.filter(row => {
                        const cond1 = evaluateCondition(row, column, op, value);
                        const cond2 = evaluateCondition(row, column2, op2, value2);
                        return combine === 'AND' ? (cond1 && cond2) : (cond1 || cond2);
                    });
                    queryDesc = `(${column} ${op} ${value}) ${combine} (${column2} ${op2} ${value2})`;
                }
            }
            
            const html = `<h3>Results (${results.length} rows)</h3>` +
                (queryDesc ? `<p><strong>Query:</strong> ${queryDesc}</p>` : '') +
                `<table><thead><tr>` +
                table.columns.map(c => `<th>${c.name}</th>`).join('') + '</tr></thead><tbody>' +
                results.map(r => '<tr>' + table.columns.map(c => `<td>${r[c.name]}</td>`).join('') + '</tr>').join('') +
                '</tbody></table>';
            document.getElementById('queryResults').innerHTML = html;
            logChange('QUERY', `Queried table '${table.name}' with ${queryDesc || 'no conditions'} - found ${results.length} rows`);
        }

        function showAllTables() {
            const div = document.getElementById('allTables');
            if (tables.length === 0) {
                div.innerHTML = '<p>No tables created yet.</p>';
                return;
            }
            div.innerHTML = tables.map((t, ti) => 
                `<h3>${t.name} (${t.rows.length} rows)</h3><table><thead><tr>` +
                t.columns.map(c => `<th>${c.name}</th>`).join('') + '<th>Actions</th></tr></thead><tbody>' +
                t.rows.map((r, ri) => '<tr>' + t.columns.map(c => `<td>${r[c.name]}</td>`).join('') + 
                    `<td><button class="btn btn-danger" onclick="deleteRow(${ti}, ${ri})">Delete</button></td></tr>`).join('') +
                '</tbody></table>'
            ).join('');
        }

        function deleteRow(tableIndex, rowIndex) {
            const tableName = tables[tableIndex].name;
            tables[tableIndex].rows.splice(rowIndex, 1);
            saveToLocalStorage();
            logChange('DELETE ROW', `Row deleted from table '${tableName}' at index ${rowIndex}`);
            showMessage('Row deleted!', 'success');
            showAllTables();
        }

        function cloneTable() {
            const tableIndex = document.getElementById('cloneTable').value;
            if (!tableIndex) return showMessage('Select a table', 'error');
            
            const original = tables[tableIndex];
            const cloned = {
                name: original.name + '_Clone',
                columns: [...original.columns],
                rows: original.rows.map(r => ({...r}))
            };
            tables.push(cloned);
            saveToLocalStorage();
            logChange('CLONE TABLE', `Table '${original.name}' cloned to '${cloned.name}'`);
            showMessage(`Table '${original.name}' cloned!`, 'success');
            updateSelects();
        }

        function deleteTable() {
            const tableIndex = document.getElementById('deleteTable').value;
            if (!tableIndex) return showMessage('Select a table', 'error');
            
            const tableName = tables[tableIndex].name;
            if (confirm(`Are you sure you want to delete table '${tableName}'?`)) {
                tables.splice(tableIndex, 1);
                saveToLocalStorage();
                logChange('DELETE TABLE', `Table '${tableName}' deleted`);
                showMessage(`Table '${tableName}' deleted!`, 'success');
                updateSelects();
            }
        }
    </script>
</body>
</html>
